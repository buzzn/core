#!/usr/bin/env ruby

# script to get a unique list of all fabricate calls used in specs. use like this:
# grep -rh --include=*.rb --exclude-dir=spec/old_fabricators Fabricate spec | bin/uniq_fabricators

grep  = ARGF.read
lines = grep.split("\n").map(&:strip)

fabricate_calls = lines.map do |line|
  # remove (optional) assignment to variable; like 'var_name = Fabricate'
  line = line.split("=", 2).last.strip
  matches = /Fabricate(\.build)?\(:([a-z0-9_]+)/.match(line)
  begin
    matches[2]
  rescue
    nil # factories that fail here are common, we already have them.
  end
end

fabricate_calls.compact!.uniq!.sort! # remove nils, make unique, order alphabetically

fabricate_calls.each { |line| puts line }

p fabricate_calls.size
