%nav.navbar.navbar-default.navbar-fixed-top
  .container

    .navbar-header
      %button.navbar-toggle{"data-target" => ".navbar-collapse", "data-toggle" => "collapse", :type => "button"}
        %span.sr-only Toggle navigation
        %span.icon-bar
        %span.icon-bar
        %span.icon-bar

      = link_to image_tag('bz_logo_green.png'), root_path, class: 'navbar-logo'

    .collapse.navbar-collapse

      %ul.nav.navbar-nav.navbar-right
        - if user_signed_in?
          %li.dropdown
            %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
              %i.fa.fa-home.fa-fw
              = t'locations'
              %b.caret
            %ul.dropdown-menu
              - current_user.editable_locations.each do |location|
                %li= link_to location.address.name, location
              %li.divider
              %li= new_location

          %li.dropdown
            %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
              %i.fa.fa-users.fa-fw
              = t'groups'
              %b.caret
            %ul.dropdown-menu
              - if !current_user.editable_groups.empty?
                - current_user.editable_groups.each do |group|
                  %li= link_to group.name, group
              %li.divider
              - current_user.editable_metering_points.each do |metering_point|
                - if metering_point.mode == 'out' && metering_point.group == nil
                  %li= new_group
                  - break # what if somebody has > 1 out-metering_points or if the out-metering_point is already in a group?

          %li.dropdown
            %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
              %i.fa.fa-bolt.fa-fw
              = t'devices'
              %b.caret
            %ul.dropdown-menu
              - if !current_user.editable_devices.empty?
                - current_user.editable_devices.each do |device|
                  %li= link_to device.name, device
              %li.divider
              %li= new_in_device




          %li.dropdown
            %a.dropdown-toggle{"data-toggle" => "dropdown", :href => "#"}
              %i.fa.fa-user.fa-fw
              = current_user.name
              %b.caret
            %ul.dropdown-menu
              %li= link_to t('my_profile'), current_user.profile
              %li= link_to t('edit_account'), edit_user_registration_path
              %li= link_to t('supply_with_current'), complete_user_wizard_producers_path
              - if current_user.contracting_party
                %li= link_to t('contracting_party'), edit_contracting_party_path(current_user.contracting_party)
              %li.divider
              %li= link_to t('logout'), destroy_user_session_path, :method => 'delete'
        - else
          %li= link_to t('sign_in'), new_user_session_path
          %li= link_to t('sign_up'), new_user_registration_path






