$(".modal-dialog").html("<%= escape_javascript( render 'wizard_meters/edit_wizard') %>");

var form;

form = $("#edit_" + "<%= escape_javascript( @meter.class_name) %>" + "_" + "<%= escape_javascript( @meter.id) %>").show();

form.steps({
  headerTag: 'h3',
  bodyTag: 'fieldset',
  transitionEffect: 'slideLeft',
  labels: {
    current: "<%= escape_javascript( t('current_step')) %>",
    pagination: "<%= escape_javascript( t('pagination')) %>",
    finish: "<%= escape_javascript( t('save')) %>",
    next: "<%= escape_javascript( t('next')) %>",
    previous: "<%= escape_javascript( t('back')) %>",
    loading: "<%= escape_javascript( t('loading')) %>..."
  },
  onStepChanging: function(event, currentIndex, newIndex) {
    if (currentIndex > newIndex) {
      return true;
    }
    if (currentIndex < newIndex) {
      form.find('.body:eq(' + newIndex + ') label.error').remove();
      form.find('.body:eq(' + newIndex + ') .error').removeClass('error');
    }
    form.validate().settings.ignore = ':disabled,:hidden';
    return form.valid();
  },
  onStepChanged: function(event, currentIndex, priorIndex) {
    // if (currentIndex === 2 && Number($('#age-2').val()) >= 18) {
    //   form.steps('next');
    // }
  },
  onFinishing: function(event, currentIndex) {
    form.validate().settings.ignore = ':disabled,:hidden';
    return form.valid();
  },
  onFinished: function(event, currentIndex) {
    form.submit();
  }
}).validate({
  errorPlacement: function(error, element) {
    element.after(error);
  },
  messages: {
    required: "<%= escape_javascript( t('errors.messages.blank'))%>",
    number: "<%= escape_javascript( t('errors.messages.not_a_number'))%>",
    equalTo: "<%= escape_javascript( t('errors.messages.confirmation'))%>",
    accept: "<%= escape_javascript( t('errors.messages.accepted'))%>",
    unique: "<%= escape_javascript( t('errors.messages.already_exists'))%>"
  }
});
